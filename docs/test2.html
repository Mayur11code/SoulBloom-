<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Bloom - Your Virtual Garden for Mental Wellness</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* Custom CSS for the animated background and other effects */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s, color 0.5s;
        }
        .font-playfair {
            font-family: 'Playfair Display', serif;
        }
        
        #garden-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background-color: #f0fdf4; /* Light mode bg */
            transition: background-color 0.5s;
        }

        .dark #garden-bg {
            background-color: #04161b; /* Dark mode bg */
        }
        
        #bg-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .leaf {
            position: absolute;
            width: 40px;
            height: 40px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 8C8 10 5.9 16.17 3.82 21.34L5.71 22L6.66 19.7C7.14 18.45 7.93 17.37 8.95 16.54C10 15.64 11.22 15 12.5 15H17V12H12.5C11.54 12 10.64 11.73 9.84 11.23C9.04 10.73 8.36 10.05 7.85 9.24C7.05 7.94 6.75 6.45 7 5C7.25 3.55 8.06 2.22 9.24 1.28L10.47 2.5L9.5 3.47C9.06 3.91 8.72 4.45 8.5 5C8.25 5.55 8.12 6.16 8.12 6.79C8.12 7.41 8.25 8.03 8.5 8.5C8.72 9.05 9.06 9.59 9.5 10.03L10.47 11L17 11V8Z" fill="%234ade80"/></svg>');
            background-size: contain;
            animation: float 25s infinite linear;
            opacity: 0;
        }

        .dark .leaf {
             background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 8C8 10 5.9 16.17 3.82 21.34L5.71 22L6.66 19.7C7.14 18.45 7.93 17.37 8.95 16.54C10 15.64 11.22 15 12.5 15H17V12H12.5C11.54 12 10.64 11.73 9.84 11.23C9.04 10.73 8.36 10.05 7.85 9.24C7.05 7.94 6.75 6.45 7 5C7.25 3.55 8.06 2.22 9.24 1.28L10.47 2.5L9.5 3.47C9.06 3.91 8.72 4.45 8.5 5C8.25 5.55 8.12 6.16 8.12 6.79C8.12 7.41 8.25 8.03 8.5 8.5C8.72 9.05 9.06 9.59 9.5 10.03L10.47 11L17 11V8Z" fill="%2322c55e"/></svg>');
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: translateY(-10vh) rotate(720deg); opacity: 0; }
        }

        /* Glassmorphism effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .dark .glass-card {
            color: white;
            background: rgba(41, 128, 61, 0.2);
            border: 1px solid rgba(102, 90, 90, 0.1);
        }

        /* Scrollbar styles */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        .dark ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #86efac; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #22c55e; }
        ::-webkit-scrollbar-thumb:hover { background: #4ade80; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #16a34a; }
        
        /* Scroll Animation CSS */
        .revealable {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .revealable.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Gemini Modal Styles */
        #gemini-modal-overlay { transition: opacity 0.3s ease-in-out; }
        #gemini-modal { transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out; max-height: 90vh; overflow-y: auto;}
        .dot-flashing {
            position: relative; width: 10px; height: 10px;
            border-radius: 5px; background-color: #22c55e; color: #22c55e;
            animation: dotFlashing 1s infinite linear alternate; animation-delay: .5s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: ''; display: inline-block; position: absolute; top: 0;
        }
        .dot-flashing::before {
            left: -15px; width: 10px; height: 10px; border-radius: 5px;
            background-color: #22c55e; color: #22c55e;
            animation: dotFlashing 1s infinite alternate; animation-delay: 0s;
        }
        .dot-flashing::after {
            left: 15px; width: 10px; height: 10px; border-radius: 5px;
            background-color: #22c55e; color: #22c55e;
            animation: dotFlashing 1s infinite alternate; animation-delay: 1s;
        }

        @keyframes dotFlashing {
            0% { background-color: #22c55e; }
            50%, 100% { background-color: #a7f3d0; }
        }

        #meditation-player {
            width: 100%;
            margin-top: 1rem;
        }

        /* 3D Flexbox Transitions */
        .perspective-parent {
            perspective: 1000px;
        }

        .transition-3d, .transition-3d-left, .transition-3d-right, .transition-3d-lift {
            transition: transform 0.5s ease, box-shadow 0.5s ease;
            transform-style: preserve-3d;
        }

        .transition-3d:hover {
            transform: rotateY(7deg) scale(1.05);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .dark .transition-3d:hover {
             box-shadow: 0 20px 25px -5px rgba(34, 197, 94, 0.15), 0 10px 10px -5px rgba(34, 197, 94, 0.1);
        }

        .transition-3d-left:hover {
            transform: rotateY(-12deg) scale(1.03);
            box-shadow: 15px 0 25px -10px rgba(0, 0, 0, 0.1);
        }
        .dark .transition-3d-left:hover {
             box-shadow: 15px 0 25px -10px rgba(34, 197, 94, 0.15);
        }
        
        .transition-3d-right:hover {
            transform: rotateY(12deg) scale(1.03);
            box-shadow: -15px 0 25px -10px rgba(0, 0, 0, 0.1);
        }
        .dark .transition-3d-right:hover {
             box-shadow: -15px 0 25px -10px rgba(34, 197, 94, 0.15);
        }
        
        .transition-3d-lift:hover {
            transform: translateZ(20px) scale(1.05);
            box-shadow: 0 25px 30px -10px rgba(0, 0, 0, 0.2), 0 10px 15px -5px rgba(0, 0, 0, 0.1);
        }
        .dark .transition-3d-lift:hover {
            box-shadow: 0 25px 30px -10px rgba(34, 197, 94, 0.25), 0 10px 15px -5px rgba(34, 197, 94, 0.2);
        }

        /* New Flip Card Styles */
        .flip-card {
            background-color: transparent;
            width: 100%;
            min-height: 320px; /* Adjust height as needed */
            perspective: 1000px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.7s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            border-radius: 1rem;
        }

        .flip-card-inner.is-flipped {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            border-radius: 1rem; /* from rounded-2xl */
        }

        .flip-card-back {
            transform: rotateY(180deg);
        }

        /* Navigation Link Hover Effect */
        header nav a {
            position: relative;
            padding-bottom: 5px;
        }

        header nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0%;
            height: 2px;
            background-color: #16a34a;
            transition: width 0.4s ease;
        }

        header nav a:hover::after {
            width: 100%;
        }

        .dark header nav a::after {
            background-color: #4ade80;
        }


    </style>
</head>
<body class="bg-green-50 dark:bg-gray-900 text-gray-900 dark:text-gray-200">

    <div id="garden-bg">
        <canvas id="bg-canvas"></canvas>
    </div>

    <header id="header" class="fixed w-full top-0 z-50 transition-all duration-300 glass-card text-gray-900 dark:text-white">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center ">
            <a href="#" class="text-3xl font-bold font-playfair text-green-700 dark:text-white">
                Soul Bloom
            </a>
            <nav class="hidden md:flex items-center space-x-8">
                <a href="#features" class="text-gray-900 dark:text-gray-50 hover:text-green-600 dark:hover:text-green-300 transition">Features</a>
                <a href="#your-garden" class="text-gray-900 dark:text-gray-50 hover:text-green-600 dark:hover:text-green-300 transition">Your Garden</a>
                <a href="#mission" class="text-gray-900 dark:text-gray-50 hover:text-green-600 dark:hover:text-green-300 transition">Our Mission</a>
                <a href="#support" class="text-gray-900 dark:text-gray-50 hover:text-green-600 dark:hover:text-green-300 transition">Peer Support</a>
            </nav>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <svg id="theme-icon-light" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <svg id="theme-icon-dark" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
                <a href="#" class="bg-white/50 dark:bg-gray-700/50 border border-green-600 text-green-700 dark:text-green-300 font-bold py-2 px-6 rounded-full transition-transform transform hover:scale-105">
                    Mentor Login
                </a>
                <a href="#" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full transition-transform transform hover:scale-105">
                    Launch App
                </a>
            </div>
        </div>
    </header>

    <main class="relative overflow-hidden">
        <section class="min-h-screen flex items-center pt-24">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-5xl md:text-7xl font-playfair font-bold text-gray-900 dark:text-white mb-4 leading-tight">
                    Nurture Your Mind, 
                    <span class="bg-gradient-to-r from-green-500 to-emerald-600 dark:from-green-400 dark:to-emerald-500 bg-clip-text text-transparent">
                        Let Your Soul Bloom.
                    </span>
                </h1>
                <p class="text-lg text-gray-700 dark:text-gray-400 max-w-3xl mx-auto mb-8 leading-relaxed">
                    A safe, stigma-free space for students to cultivate mental wellness. Your confidential garden for growth and support is just a click away.
                </p>
                <a href="#" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-10 rounded-full transition-transform transform hover:scale-105 inline-block text-lg">
                    Explore Your Garden
                </a>
            </div>
        </section>

        <section id="features" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 revealable">
                    <h2 class="text-4xl font-playfair font-bold text-gray-900 dark:text-white">A Garden of Support</h2>
                    <p class="mt-2 text-lg text-gray-700 dark:text-gray-400">Everything you need to tend to your mental wellbeing.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 revealable">
                    <!-- Card 1: AI-Guided First-Aid -->
                    <div class="flip-card">
                        <div class="flip-card-inner">
                            <div class="flip-card-front glass-card p-6 flex flex-col items-center justify-center text-center">
                                <div class="bg-green-200 dark:bg-green-900/50 h-20 w-20 rounded-full mx-auto flex items-center justify-center mb-4">
                                    <svg class="h-10 w-10 text-green-700 dark:text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 9.75a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 01.778-.332 48.294 48.294 0 005.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" /></svg>
                                </div>
                                <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">AI-Guided First-Aid</h3>
                                <button id="open-gemini-modal" class="mt-6 w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition relative z-10">Talk to Blossom ✨</button>
                            </div>
                            <div class="flip-card-back glass-card p-6 flex items-center justify-center text-center">
                                <p class="text-lg font-semibold italic text-gray-800 dark:text-gray-200 leading-relaxed">Get instant, friendly support and coping strategies from our AI companion, Blossom, anytime you need it.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Card 2: Confidential Booking -->
                    <div class="flip-card">
                        <div class="flip-card-inner">
                            <div class="flip-card-front glass-card p-6 flex flex-col items-center justify-center text-center">
                                <div class="bg-green-200 dark:bg-green-900/50 h-20 w-20 rounded-full mx-auto flex items-center justify-center mb-4">
                                    <svg class="h-10 w-10 text-green-700 dark:text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>
                                </div>
                                <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Confidential Booking</h3>
                            </div>
                            <div class="flip-card-back glass-card p-6 flex items-center justify-center text-center">
                                <p class="text-lg font-semibold italic text-gray-800 dark:text-gray-200 leading-relaxed">Securely and privately book appointments with your on-campus counsellor. Your privacy is our priority.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Card 3: Psychoeducational Hub -->
                    <div class="flip-card">
                        <div class="flip-card-inner">
                            <div class="flip-card-front glass-card p-6 flex flex-col items-center justify-center text-center">
                                <div class="bg-green-200 dark:bg-green-900/50 h-20 w-20 rounded-full mx-auto flex items-center justify-center mb-4">
                                    <svg class="h-10 w-10 text-green-700 dark:text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                                </div>
                                <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Psychoeducational Hub</h3>
                            </div>
                            <div class="flip-card-back glass-card p-6 flex items-center justify-center text-center">
                                <p class="text-lg font-semibold italic text-gray-800 dark:text-gray-200 leading-relaxed">Access a library of videos, relaxation audio, and wellness guides in regional languages, tailored for you.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Card 4: Peer Support Forum -->
                    <div class="flip-card">
                        <div class="flip-card-inner">
                            <div class="flip-card-front glass-card p-6 flex flex-col items-center justify-center text-center">
                                <div class="bg-green-200 dark:bg-green-900/50 h-20 w-20 rounded-full mx-auto flex items-center justify-center mb-4">
                                    <svg class="h-10 w-10 text-green-700 dark:text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.952A3 3 0 006 11.25m-3 2.25c0-1.03.821-1.875 1.875-1.875M9 11.25v-1.5c0-1.03.821-1.875 1.875-1.875m-1.875 0c.502 0 .965.188 1.336.516m-1.336-.516c-.502 0-.965.188-1.336.516m6 0v-1.5c0-1.03-.821-1.875-1.875-1.875m1.875 0c-.502 0-.965-.188-1.336.516m-1.336-.516c.502 0 .965.188 1.336.516M12 6.75v-1.5c0-1.03.821-1.875 1.875-1.875m-1.875 0c.502 0 .965.188 1.336.516m-1.336-.516c-.502 0-.965.188-1.336.516" /></svg>
                                </div>
                                <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">Peer Support Forum</h3>
                            </div>
                            <div class="flip-card-back glass-card p-6 flex items-center justify-center text-center">
                                <p class="text-lg font-semibold italic text-gray-800 dark:text-gray-200 leading-relaxed">Connect with trained student volunteers in a moderated, safe forum. You are not alone in this journey.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="your-garden" class="py-20">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-4xl font-playfair font-bold text-gray-900 dark:text-white mb-4 revealable">Watch Your Garden Grow</h2>
                <p class="text-lg max-w-3xl mx-auto mb-12 text-gray-700 dark:text-gray-400 leading-relaxed revealable">
                    As you engage with Soul Bloom, complete exercises, and connect with peers, you'll see your personal virtual plant flourish, symbolizing your journey towards mental wellbeing.
                </p>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 items-end revealable perspective-parent">
                        <div class="flex flex-col items-center p-4 transition-3d-lift rounded-2xl glass-card">
                            <svg class="h-24 w-24 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M12,13c-0.55,0-1-0.45-1-1V8c0-0.55,0.45-1,1-1s1,0.45,1,1v4C13,12.55,12.55,13,12,13z"></path><path d="M12.5,15h-1C11.22,15,11,15.22,11,15.5v1C11,16.78,11.22,17,11.5,17h1c0.28,0,0.5-0.22,0.5-0.5v-1 C13,15.22,12.78,15,12.5,15z"></path><path d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.41,0-8-3.59-8-8s3.59-8,8-8 s8,3.59,8,8S16.41,20,12,20z"></path></g></svg>
                            <h3 class="font-bold mt-4 text-xl text-gray-800 dark:text-gray-200">The First Sprout</h3>
                            <p class="text-gray-600 dark:text-gray-400">Starting your journey</p>
                        </div>
                        <div class="flex flex-col items-center p-4 transition-3d-lift rounded-2xl glass-card">
                            <svg class="h-32 w-32 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M17 8C8 10 5.9 16.17 3.82 21.34L5.71 22L6.66 19.7C7.14 18.45 7.93 17.37 8.95 16.54C10 15.64 11.22 15 12.5 15H17V12H12.5C11.54 12 10.64 11.73 9.84 11.23C9.04 10.73 8.36 10.05 7.85 9.24C7.05 7.94 6.75 6.45 7 5C7.25 3.55 8.06 2.22 9.24 1.28L10.47 2.5L9.5 3.47C9.06 3.91 8.72 4.45 8.5 5C8.25 5.55 8.12 6.16 8.12 6.79C8.12 7.41 8.25 8.03 8.5 8.5C8.72 9.05 9.06 9.59 9.5 10.03L10.47 11L17 11V8Z"/></svg>
                            <h3 class="font-bold mt-4 text-xl text-gray-800 dark:text-gray-200">Growing Strong</h3>
                            <p class="text-gray-600 dark:text-gray-400">Completing modules</p>
                        </div>
                        <div class="flex flex-col items-center p-4 transition-3d-lift rounded-2xl glass-card">
                            <svg class="h-40 w-40 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C9.24 2 7 4.24 7 7c0 2.22 1.41 4.1 3.33 4.72V12c-1.48-.61-2.5-2.02-2.5-3.64C7.83 6.1 9.71 4 12 4s4.17 2.1 4.17 4.36c0 1.62-1.02 3.03-2.5 3.64v-.28c1.92-.62 3.33-2.5 3.33-4.72C17 4.24 14.76 2 12 2zM8.05 13c-1.39.53-2.53 1.4-3.55 2.54V15c0-1.65 1.35-3 3-3h.5V13zm8.45.5c-0.29-0.54-0.65-1.03-1.07-1.46.42.43.78.92 1.07 1.46zM15 12h-1.5c-1.65 0-3 1.35-3 3v.54c1.02-1.14 2.16-2.01 3.55-2.54H15c1.65 0 3 1.35 3 3v.54c-1.02-1.14-2.16-2.01-3.55-2.54z"/><path d="M12 14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
                            <h3 class="font-bold mt-4 text-xl text-gray-800 dark:text-gray-200">Ready to Bud</h3>
                            <p class="text-gray-600 dark:text-gray-400">Connecting with support</p>
                        </div>
                        <div class="flex flex-col items-center p-4 transition-3d-lift rounded-2xl glass-card">
                            <svg class="h-48 w-48 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><path d="m12 10.59-1.41 1.41L12 13.41l1.41-1.41L12 10.59zM16.24 7.76l-1.41 1.41C15.54 9.88 16 10.89 16 12s-.46 2.12-1.17 2.83l1.41 1.41C17.39 15.08 18 13.57 18 12s-.61-3.08-1.76-4.24zM7.76 16.24l1.41-1.41C8.46 14.12 8 13.11 8 12s.46-2.12 1.17-2.83L7.76 7.76C6.61 8.92 6 10.43 6 12s.61 3.08 1.76 4.24z"/><path d="M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"/></svg>
                            <h3 class="font-bold mt-4 text-xl text-gray-800 dark:text-gray-200">In Full Bloom</h3>
                            <p class="text-gray-600 dark:text-gray-400">Cultivating balance</p>
                        </div>
                </div>
            </div>
        </section>

        <section id="mission" class="py-20">
            <div class="container mx-auto px-6">
                <div class="flex flex-col md:flex-row items-center gap-12 perspective-parent">
                    <div class="md:w-1/2 revealable transition-3d-right">
                         <img src=".Sources/Screenshot%202025-10-18%20093208.png"
                              alt="https://placehold.co/600x400/a7f3d0/14532d?text=Soul+Bloom+Community" 
                              class="rounded-2xl shadow-lg w-full">
                    </div>
                    <div class="md:w-1/2 revealable transition-3d-left glass-card p-6 rounded-2xl">
                        <h2 class="text-4xl font-playfair font-bold text-gray-900 dark:text-white mb-4">Our Mission: Bridging the Gap</h2>
                        <p class="text-gray-700 dark:text-gray-300 mb-4 text-lg leading-relaxed">
                            We recognize the silent struggles of students. High stress, anxiety, and the fear of judgment often prevent them from seeking help. Generic, one-size-fits-all solutions don't address the unique cultural and institutional challenges students face.
                        </p>
                        <p class="text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
                            Soul Bloom is a tailored, open-source solution designed specifically for you. We integrate regional context, map to your college's support system, and provide a stigma-free environment to ensure every student has access to the care they deserve.
                        </p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="support" class="py-20">
            <div class="container mx-auto px-6 text-center perspective-parent">
                <h2 class="text-4xl font-playfair font-bold text-gray-900 dark:text-white mb-4 revealable">Find Strength in Community</h2>
                <p class="text-lg max-w-3xl mx-auto mb-8 text-gray-700 dark:text-gray-400 leading-relaxed revealable">
                    Our peer support platform is a place for connection and shared understanding. Led by trained student volunteers, it's a space to share experiences, offer support, and grow together.
                </p>
                <div class="relative max-w-4xl mx-auto glass-card rounded-2xl p-8 revealable transition-3d">
                    <div class="space-y-4 text-left">
                        <div class="flex items-start gap-3">
                            <div class="bg-green-200 text-green-800 dark:bg-green-900 dark:text-green-200 h-10 w-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold">A</div>
                            <div class="bg-gray-200 dark:bg-gray-700 p-4 rounded-lg rounded-tl-none">
                                <p class="font-semibold text-gray-900 dark:text-gray-100">Alex</p>
                                <p class="text-gray-800 dark:text-gray-200">I've been feeling so overwhelmed with exams lately. It's hard to find the motivation to even start studying.</p>
                            </div>
                        </div>
                         <div class="flex items-start gap-3 justify-end">
                            <div class="bg-green-500/50 dark:bg-green-800/50 p-4 rounded-lg rounded-br-none order-1">
                                <p class="font-semibold text-gray-900 dark:text-gray-100">Ben (Volunteer)</p>
                                <p class="text-gray-800 dark:text-gray-200">I completely understand that feeling, Alex. It's tough. One thing that helped me was breaking tasks down into tiny steps. Have you tried the Pomodoro technique?</p>
                            </div>
                            <div class="bg-blue-200 text-blue-800 dark:bg-blue-900 dark:text-blue-200 h-10 w-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold order-2">B</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="gemini-modal-overlay" class="fixed inset-0 bg-black/60 z-[100] hidden opacity-0 flex items-center justify-center p-4">
        <div id="gemini-modal" class="w-full max-w-md bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg rounded-2xl shadow-2xl p-6 relative">
            <button id="close-gemini-modal" class="absolute top-4 right-4 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div class="text-center">
                <h3 class="text-2xl font-bold font-playfair text-gray-900 dark:text-white">Chat with Blossom ✨</h3>
            </div>
            
            <div class="mt-4">
                <p class="text-gray-600 dark:text-gray-400 mt-2 text-center">How are you feeling right now?</p>
                <textarea id="gemini-prompt-input" rows="3" class="w-full mt-2 p-3 text-gray-800 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:border-green-500 focus:ring-0 rounded-lg transition" placeholder="e.g., I'm feeling stressed..."></textarea>
                <button id="gemini-submit-button" class="w-full mt-2 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">
                    Get Quick Support
                </button>
                <div id="gemini-response-area" class="mt-4 p-4 bg-green-50 dark:bg-gray-700/50 rounded-lg min-h-[100px] text-gray-700 dark:text-gray-200 leading-relaxed text-left">
                    <div id="gemini-loading-indicator" class="hidden h-full flex items-center justify-center">
                        <div class="dot-flashing"></div>
                    </div>
                    <p id="gemini-response-text">Your supportive message will appear here...</p>
                </div>
            </div>

            <hr class="my-6 border-gray-300 dark:border-gray-600">

            <div class="mt-4">
                <p class="text-gray-600 dark:text-gray-400 mt-2 text-center">Need to relax? Let's create a guided meditation.</p>
                <input type="text" id="meditation-prompt-input" class="w-full mt-2 p-3 text-gray-800 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:border-green-500 focus:ring-0 rounded-lg transition" placeholder="e.g., 5-minute meditation for anxiety">
                <button id="generate-meditation-button" class="w-full mt-2 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">
                    Create Meditation
                </button>
                <div id="meditation-status-area" class="mt-4 text-center text-gray-600 dark:text-gray-400">
                    <div id="meditation-loading-indicator" class="hidden flex flex-col items-center justify-center">
                        <div class="dot-flashing"></div>
                        <p id="meditation-status-text" class="mt-4 text-sm">Generating script...</p>
                    </div>
                     <audio id="meditation-player" controls class="hidden"></audio>
                </div>
            </div>
            
             <p class="text-xs text-center text-gray-500 dark:text-gray-500 mt-6">Disclaimer: Blossom is an AI companion and not a substitute for professional medical advice. For immediate help, please contact a helpline.</p>
        </div>
    </div>
    
    <footer class="bg-gray-100/50 dark:bg-gray-900/50 mt-10 py-8">
        <div class="container mx-auto px-6 text-center text-gray-600 dark:text-gray-400">
            <p>&copy; 2025 Soul Bloom. All Rights Reserved.</p>
            <p class="text-sm mt-1">A project dedicated to improving student mental health, one step at a time.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // ====================================================================
            // SECTION: HELPER FUNCTIONS (API, TTS, etc.)
            // ====================================================================
            
            async function fetchWithBackoff(url, options, retries = 4) {
                let delay = 1000; // Initial delay
                for (let i = 0; i <= retries; i++) {
                    try {
                        const response = await fetch(url, options);
                        // If response is ok, return it
                        if (response.ok) return response;

                        // Don't retry for client-side errors (4xx) other than rate limiting
                        if (response.status >= 400 && response.status < 500 && response.status !== 429) {
                           console.error(`Client Error: ${response.status}. Aborting retries.`);
                           // Throw an error to be caught by the calling function's catch block
                           throw new Error(`API Client Error (${response.status}): ${await response.text()}`);
                        }
                        
                        // For server errors (5xx) or rate limiting (429), we retry
                        if (i === retries) break; // If it's the last retry, break and throw error below

                        console.log(`API Error: Status ${response.status}. Retrying in ${delay}ms...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff

                    } catch (error) {
                        // This catches network errors (e.g., fetch fails to send)
                        if (i === retries) {
                           console.error("Maximum retries reached for network error.");
                           throw error; // Re-throw the final error
                        }
                        console.log(`Network error. Retrying in ${delay}ms...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff
                    }
                }
                throw new Error(`API request failed after ${retries} retries.`);
            }

            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            }
            
            /**
             * BUG FIX: Correctly converts raw PCM audio data (as an ArrayBuffer) into a playable WAV Blob.
             * The original function had a bug trying to access '.buffer' on an ArrayBuffer.
             */
            function pcmToWav(pcmData, sampleRate) {
                const numChannels = 1;
                const bitsPerSample = 16;
                const dataSize = pcmData.byteLength;
                const buffer = new ArrayBuffer(44 + dataSize);
                const view = new DataView(buffer);

                function writeString(view, offset, string) {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                }
                
                const byteRate = sampleRate * numChannels * (bitsPerSample / 8);
                const blockAlign = numChannels * (bitsPerSample / 8);
                
                // WAV Header
                writeString(view, 0, 'RIFF');
                view.setUint32(4, 36 + dataSize, true);
                writeString(view, 8, 'WAVE');
                writeString(view, 12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true); // PCM
                view.setUint16(22, numChannels, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, byteRate, true);
                view.setUint16(32, blockAlign, true);
                view.setUint16(34, bitsPerSample, true);
                writeString(view, 36, 'data');
                view.setUint32(40, dataSize, true);
                
                // Write PCM data
                const pcm = new Int16Array(pcmData);
                for (let i = 0; i < pcm.length; i++) {
                    view.setInt16(44 + i * 2, pcm[i], true);
                }

                return new Blob([view], { type: 'audio/wav' });
            }


            // ====================================================================
            // SECTION: GENERAL PAGE LOGIC & SETUP
            // ====================================================================
            const themeToggle = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const htmlElement = document.documentElement;

            if (localStorage.getItem('theme') === 'light' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: light)').matches)) {
                htmlElement.classList.remove('dark');
                themeIconLight.classList.remove('hidden');
                themeIconDark.classList.add('hidden');
            } else {
                htmlElement.classList.add('dark');
                themeIconLight.classList.add('hidden');
                themeIconDark.classList.remove('hidden');
            }

            themeToggle.addEventListener('click', () => {
                htmlElement.classList.toggle('dark');
                themeIconLight.classList.toggle('hidden');
                themeIconDark.classList.toggle('hidden');
                localStorage.setItem('theme', htmlElement.classList.contains('dark') ? 'dark' : 'light');
            });

            const gardenBg = document.getElementById('garden-bg');
            for (let i = 0; i < 20; i++) {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                leaf.style.left = `${Math.random() * 100}vw`;
                leaf.style.animationDuration = `${15 + Math.random() * 20}s`;
                leaf.style.animationDelay = `${Math.random() * 10}s`;
                leaf.style.transform = `scale(${0.5 + Math.random() * 0.8})`;
                leaf.style.opacity = '0';
                gardenBg.appendChild(leaf);
            }

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                });
            });

            const header = document.getElementById('header');
            window.addEventListener('scroll', () => {
                header.classList.toggle('py-2', window.scrollY > 50);
                header.classList.toggle('py-4', window.scrollY <= 50);
            });

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('is-visible');
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.revealable').forEach(el => observer.observe(el));

            // Flip card on click logic
            document.querySelectorAll('.flip-card').forEach(card => {
                card.addEventListener('click', function(event) {
                    const button = card.querySelector('button');
                    // Prevent flipping if the button itself or a child of the button is clicked
                    if (button && (event.target === button || button.contains(event.target))) {
                        return;
                    }

                    const clickedCardInner = this.querySelector('.flip-card-inner');

                    // Unflip all other cards that are currently flipped
                    document.querySelectorAll('.flip-card-inner.is-flipped').forEach(flippedCard => {
                        if (flippedCard !== clickedCardInner) {
                            flippedCard.classList.remove('is-flipped');
                        }
                    });

                    // Toggle the clicked card
                    clickedCardInner.classList.toggle('is-flipped');
                });
            });


            // ====================================================================
            // SECTION: GEMINI AI MODAL & API LOGIC
            // ====================================================================
            
            // The API key is an empty string. The runtime environment will provide it.
            const apiKey = ""; 
            
            const modalOverlay = document.getElementById('gemini-modal-overlay');
            const modal = document.getElementById('gemini-modal');
            const openModalButton = document.getElementById('open-gemini-modal');
            const closeModalButton = document.getElementById('close-gemini-modal');

            // Text Chat Elements
            const submitButton = document.getElementById('gemini-submit-button');
            const promptInput = document.getElementById('gemini-prompt-input');
            const responseText = document.getElementById('gemini-response-text');
            const loadingIndicator = document.getElementById('gemini-loading-indicator');

            // Meditation Elements
            const meditationPromptInput = document.getElementById('meditation-prompt-input');
            const generateMeditationButton = document.getElementById('generate-meditation-button');
            const meditationStatusArea = document.getElementById('meditation-status-area');
            const meditationLoadingIndicator = document.getElementById('meditation-loading-indicator');
            const meditationStatusText = document.getElementById('meditation-status-text');
            const meditationPlayer = document.getElementById('meditation-player');

            const showModal = () => {
                modalOverlay.classList.remove('hidden');
                setTimeout(() => {
                    modalOverlay.classList.remove('opacity-0');
                    modal.style.transform = 'translateY(0) scale(1)';
                    modal.style.opacity = '1';
                }, 10);
            };

            const hideModal = () => {
                modalOverlay.classList.add('opacity-0');
                modal.style.transform = 'translateY(10px) scale(0.95)';
                modal.style.opacity = '0';
                meditationPlayer.pause();
                setTimeout(() => modalOverlay.classList.add('hidden'), 300);
            };

            openModalButton.addEventListener('click', showModal);
            closeModalButton.addEventListener('click', hideModal);
            modalOverlay.addEventListener('click', e => e.target === modalOverlay && hideModal());
            document.addEventListener('keydown', (e) => {
                if(e.key === "Escape" && !modalOverlay.classList.contains('hidden')) {
                    hideModal();
                }
            });
            
            function isApiKeyMissing() {
                // In a real environment, the key would be provided. This is for local testing.
                if (apiKey === "YOUR_API_KEY" || !apiKey) { 
                    responseText.textContent = "API Key is missing or invalid. The app's functionality is limited.";
                    meditationStatusText.textContent = "API Key is missing or invalid. The app's functionality is limited.";
                    meditationLoadingIndicator.classList.add('hidden');
                    return true;
                }
                return false;
            }

            // --- Text Chat API Call ---
            submitButton.addEventListener('click', async () => {
                const userQuery = promptInput.value.trim();
                if (!userQuery) {
                    responseText.textContent = "Please tell me how you're feeling first.";
                    return;
                }

                loadingIndicator.classList.remove('hidden');
                responseText.classList.add('hidden');
                submitButton.disabled = true;
                submitButton.textContent = 'Thinking...';

                const systemPrompt = `You are Blossom, a kind, empathetic, and supportive AI companion from Soul Bloom. Your primary goal is to provide mental health first-aid and supportive conversations for students.
- Your tone should always be warm, non-judgmental, and reassuring.
- Validate the user's feelings. Start responses with phrases like "It sounds like you're going through a lot," or "Thank you for sharing that with me."
- Offer simple, actionable coping strategies (e.g., deep breathing, grounding techniques, taking a short break).
- Gently encourage them to consider reaching out to on-campus resources or the peer support forum if their distress seems significant.
- Do NOT provide medical diagnoses or act as a therapist. Include a disclaimer if the conversation becomes serious: "Remember, I'm an AI companion. For professional help, it's always best to connect with a counsellor."
- Keep responses concise and easy to read, using paragraphs and bullet points where helpful.`;

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };
                
                try {
                    const response = await fetchWithBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    const result = await response.json();
                    const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    responseText.textContent = generatedText || "I'm sorry, I couldn't think of a response. Please try again.";
                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    responseText.textContent = "Sorry, something went wrong. Please check your connection and try again.";
                } finally {
                    loadingIndicator.classList.add('hidden');
                    responseText.classList.remove('hidden');
                    submitButton.disabled = false;
                    submitButton.textContent = 'Get Quick Support';
                }
            });

            // --- Meditation Generation Logic ---
            generateMeditationButton.addEventListener('click', async () => {
                const userQuery = meditationPromptInput.value.trim();
                if (!userQuery) {
                    meditationStatusText.textContent = "Please enter a topic for your meditation.";
                    meditationLoadingIndicator.classList.add('hidden');
                    return;
                }
                
                meditationPlayer.classList.add('hidden');
                meditationPlayer.src = '';
                meditationLoadingIndicator.classList.remove('hidden');
                meditationStatusText.textContent = "Generating meditation script...";
                generateMeditationButton.disabled = true;
                generateMeditationButton.textContent = 'Creating...';
                
                try {
                    // Step 1: Generate the meditation script
                    const scriptPrompt = `Write a short, calming, guided meditation script of about 150-200 words. The topic is "${userQuery}". Address the listener directly using "you". Use simple, soothing language with pauses indicated by ellipses (...). Start with a calming introduction and end with a gentle return to awareness. Do not include any titles or introductory/concluding remarks like "Here is the script:". Just provide the script itself.`;
                    const textApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                    const textPayload = { contents: [{ parts: [{ text: scriptPrompt }] }] };
                    
                    const textResponse = await fetchWithBackoff(textApiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(textPayload) });
                    const textResult = await textResponse.json();
                    const meditationScript = textResult.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (!meditationScript) throw new Error("Could not generate a script.");
                    
                    meditationStatusText.textContent = "Converting script to audio...";

                    // Step 2: Generate the audio from the script
                    const ttsPrompt = `Read the following meditation script in a gentle, calm, and soothing voice: ${meditationScript}`;
                    const ttsApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
                    const ttsPayload = {
                        contents: [{ parts: [{ text: ttsPrompt }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Vindemiatrix" } } } // A gentle voice
                        },
                        model: "gemini-2.5-flash-preview-tts"
                    };

                    const audioResponse = await fetchWithBackoff(ttsApiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(ttsPayload) });
                    const audioResult = await audioResponse.json();
                    
                    const audioData = audioResult?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                    const mimeType = audioResult?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.mimeType;

                    if (!audioData || !mimeType || !mimeType.startsWith("audio/")) throw new Error("Invalid audio data received.");
                    
                    const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)?.[1], 10) || 24000;
                    const pcmData = base64ToArrayBuffer(audioData);
                    const wavBlob = pcmToWav(pcmData, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    meditationPlayer.src = audioUrl;
                    meditationPlayer.classList.remove('hidden');
                    meditationLoadingIndicator.classList.add('hidden');

                } catch (error) {
                    console.error("Meditation Generation Error:", error);
                    meditationStatusText.textContent = `Sorry, an error occurred. Please try again.`;
                    meditationLoadingIndicator.classList.add('hidden');
                } finally {
                    generateMeditationButton.disabled = false;
                    generateMeditationButton.textContent = 'Create Meditation';
                }
            });
        });
    </script>

    <script>
        // Separate script tag for Three.js to keep concerns separated
        if (typeof THREE !== 'undefined') {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const canvas = document.getElementById('bg-canvas');
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            let intersectedObject = null;
            let clickedObject = null;

            window.addEventListener('click', () => {
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(elementGroups, true);

                if (intersects.length > 0) {
                    let topGroup = intersects[0].object;
                    while(topGroup.parent && topGroup.name !== "FloatingElement") {
                        topGroup = topGroup.parent;
                    }

                    if (clickedObject && clickedObject !== topGroup) {
                        clickedObject.elementInstance.isClicked = false;
                    }

                    clickedObject = topGroup;
                    if (!clickedObject.elementInstance) {
                         clickedObject.elementInstance = elements.find(c => c.group === clickedObject);
                    }
                    if (clickedObject.elementInstance) {
                        clickedObject.elementInstance.isClicked = !clickedObject.elementInstance.isClicked; // Toggle click state
                    }
                } else {
                    if (clickedObject) {
                        clickedObject.elementInstance.isClicked = false;
                        clickedObject = null;
                    }
                }
            }, false);

            window.addEventListener('mousemove', (event) => {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
            }, false);

            const ambientLight = new THREE.AmbientLight(0xffffff, 1.2);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(5, 10, 7.5);
            scene.add(directionalLight);
            camera.position.z = 15;

            const calmColors = [0x4ade80, 0x34d399, 0xa7f3d0, 0xf9a8d4, 0xc4b5fd];

            class FloatingElement {
                constructor() {
                    this.group = new THREE.Group();
                    const elementColor = calmColors[Math.floor(Math.random() * calmColors.length)];
                    const bodyMaterial = new THREE.MeshStandardMaterial({ 
                        color: elementColor, 
                        roughness: 0.6, 
                        metalness: 0.1, 
                        transparent: true 
                    });
                    
                    const bodyGeometry = new THREE.IcosahedronGeometry(1.2, 0); 
                    this.body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                    
                    this.group.add(this.body);
                    this.group.name = "FloatingElement";

                    this.group.position.set(
                        (Math.random() - 0.5) * 40,
                        (Math.random() - 0.5) * 30,
                        (Math.random() - 0.5) * 10
                    );
                    
                    const scale = 1 + (this.group.position.z / 15);
                    this.group.scale.set(scale, scale, scale);
                    this.body.material.opacity = 0.6 + (this.group.position.z / 25);

                    this.velocity = new THREE.Vector3(
                        (Math.random() - 0.5) * 0.004,
                        (Math.random() - 0.5) * 0.004,
                        (Math.random() - 0.5) * 0.004
                    );
                    
                    this.rotationSpeed = new THREE.Vector3(
                        (Math.random() - 0.5) * 0.005,
                        (Math.random() - 0.5) * 0.005,
                        (Math.random() - 0.5) * 0.005
                    );

                    this.time = Math.random() * 100;
                    this.isHovered = false;
                    this.isClicked = false;
                }

                update(deltaTime) {
                    this.time += deltaTime * 2;
                    this.group.position.add(this.velocity);
                    this.group.position.y += Math.sin(this.time) * 0.01;
                    
                    if (this.isClicked) {
                        // Smoothly rotate towards the camera
                        const targetQuaternion = new THREE.Quaternion().setFromRotationMatrix(
                            new THREE.Matrix4().lookAt(this.group.position, camera.position, this.group.up)
                        );
                        this.group.quaternion.slerp(targetQuaternion, 0.05);
                    } else {
                        // If not clicked, apply the gentle tumble rotation
                        this.group.rotation.x += this.rotationSpeed.x;
                        this.group.rotation.y += this.rotationSpeed.y;
                        this.group.rotation.z += this.rotationSpeed.z;
                    }

                    if (this.group.position.x > 25) this.group.position.x = -25;
                    if (this.group.position.x < -25) this.group.position.x = 25;
                    if (this.group.position.y > 15) this.group.position.y = -15;
                    if (this.group.position.y < -15) this.group.position.y = 15;
                }
            }

            const elements = [];
            const elementGroups = [];
            for (let i = 0; i < 15; i++) {
                const el = new FloatingElement();
                elements.push(el);
                scene.add(el.group);
                elementGroups.push(el.group);
            }
            
            const clock = new THREE.Clock();

            const animate = () => {
                requestAnimationFrame(animate);
                const deltaTime = clock.getDelta();
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(elementGroups, true);

                if (intersects.length > 0) {
                    let topGroup = intersects[0].object;
                    while(topGroup.parent && topGroup.name !== "FloatingElement") {
                        topGroup = topGroup.parent;
                    }

                    if (intersectedObject !== topGroup) {
                        if (intersectedObject && intersectedObject.originalScale) {
                            intersectedObject.elementInstance.isHovered = false;
                            intersectedObject.scale.set(intersectedObject.originalScale.x, intersectedObject.originalScale.y, intersectedObject.originalScale.z);
                        }
                        
                        intersectedObject = topGroup;
                        if (!intersectedObject.elementInstance) {
                           intersectedObject.elementInstance = elements.find(c => c.group === intersectedObject);
                        }
                        
                        if (intersectedObject.elementInstance) {
                            intersectedObject.originalScale = intersectedObject.scale.clone();
                            intersectedObject.elementInstance.isHovered = true;
                            intersectedObject.scale.multiplyScalar(1.2);
                        }
                    }
                } else {
                    if (intersectedObject && intersectedObject.originalScale) {
                        intersectedObject.elementInstance.isHovered = false;
                        intersectedObject.scale.set(intersectedObject.originalScale.x, intersectedObject.originalScale.y, intersectedObject.originalScale.z);
                    }
                    intersectedObject = null;
                }

                elements.forEach(el => el.update(deltaTime));
                renderer.render(scene, camera);
            };

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            });
            
            animate();
        }
    </script>

</body>
</html>


